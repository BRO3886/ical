# Journal Entry 003 - 2026-02-12 - Agent Skill for cal CLI

## Goal
Create an Agent Skill following the agentskills.io open format so AI agents (Claude Code, Cursor, Gemini CLI, etc.) can discover and use the cal CLI for macOS Calendar operations. Modeled after the existing `rem` skill at `../rem/skills/rem-cli/`.

## What Changed
- **`skills/cal-cli/SKILL.md`** (237 lines): Main skill file with YAML frontmatter + full overview
  - Frontmatter: `name: cal-cli`, keyword-rich description, `metadata.author: sidv`, `compatibility` for macOS
  - Sections: Installation, Quick Start (7 examples), Command Reference (4 grouped tables covering all 13 commands), Key Concepts, Common Workflows, Public Go API pointer, Limitations
  - Key Concepts covers: Row Numbers (with cache workflow), Natural Language Dates, Interactive Mode (both `-i` forms and zero-arg picker), Output Formats, Recurrence (5 examples with interval/days/count/until), Alerts
- **`skills/cal-cli/references/commands.md`** (315 lines): Complete flag reference for all 13 commands
  - Each command: description, 3-5 usage examples, full flag table (flag, short, description, default), aliases
  - Commands: calendars, list, today, upcoming, show, add, update, delete, search, export, import, version, completion
  - Global flags section at bottom (`--output`, `--no-color`, `NO_COLOR`)
- **`skills/cal-cli/references/dates.md`** (106 lines): Natural language date parsing reference
  - 9 pattern categories: Keywords, Relative Time, Past References, Weekday Patterns, Keyword+Time, Month+Day, Time Only, Standard Date Formats, Alert Durations
  - All patterns cross-checked against `internal/parser/date.go`

## Key Insights
- cal defaults date keywords to **midnight (00:00)** while rem defaults to **9:00 AM** — this is the most important behavioral difference and is documented in dates.md
- rem uses short IDs (8-char UUID prefix) for event identification; cal uses row numbers (`#1`, `#2`) cached to `~/.cal-last-list` — the skill documents the row number workflow explicitly since it's non-obvious
- cal has features rem doesn't: recurrence rules, alerts, ICS export, `this week` / `X ago` / month+day date patterns — all documented
- rem has features cal doesn't: short IDs, priority levels, flagging, separate `interactive` command, `overdue` command, stats — these are simply absent from cal's skill
- No `references/go-api.md` needed unlike rem — cal doesn't expose a public Go API package, users should use `go-eventkit/calendar` directly (brief pointer in SKILL.md suffices)
- The `--all-day` flag on `update` is a **string** ("true"/"false") not a bool, to detect whether it was explicitly set — documented correctly in commands.md

## Decisions Made
- **No go-api.md reference file**: Unlike rem which has `references/go-api.md`, cal points users to `go-eventkit/calendar` with a small code snippet in SKILL.md. The cal CLI doesn't expose its own Go API package.
- **Alert durations in dates.md**: Included `--alert` duration format (15m, 1h, 2d) in the dates reference since it's a related parsing concept, even though it's technically not a "date" pattern.
- **Command grouping**: Used 4 groups (Event CRUD, Event Views, Search & Export, Other) vs rem's 5 groups — consolidated since cal has fewer command categories.

---

# Journal Entry 004 - 2026-02-12 - Calendar CRUD with go-eventkit v0.2.1

## Goal
Add full calendar management (create, update, delete) to the cal CLI, leveraging the new Calendar CRUD methods in go-eventkit v0.2.1. Includes interactive mode, proper flags, documentation updates, and a tagged release.

## What Changed

### go-eventkit upgrade (v0.1.1 → v0.2.1)
- `go get github.com/BRO3886/go-eventkit@v0.2.1`
- New methods: `CreateCalendar`, `UpdateCalendar`, `DeleteCalendar`
- New types: `CreateCalendarInput` (Title, Source, Color), `UpdateCalendarInput` (Title*, Color* — nil-pointer-unchanged pattern)
- New sentinel error: `ErrImmutable` for subscribed/birthday calendars
- Breaking change from v0.2.0: `Source` is now **required** on `CreateCalendarInput`

### `calendars.go` — Complete rewrite
Restructured from a single list command to a parent command with 4 subcommands:

- **`calendars`** (parent) — `RunE` delegates to `calendars list` for backwards compatibility
- **`calendars list`** — Same as before (list all calendars)
- **`calendars create`** — Flags: `--title/-T`, `--source/-s`, `--color`, `-i`. Title as positional arg or `--title`. Source is required. Interactive mode discovers sources from existing calendars via `buildSourceOptions()`.
- **`calendars update`** — Flags: `--title/-T`, `--color`, `-i`. With arg: find by name (case-insensitive). Without arg: interactive `pickCalendar()` picker (writable calendars only). Interactive mode pre-fills current values.
- **`calendars delete`** — Flags: `--force/-f`. Confirmation prompt with destructive warning ("will permanently delete the calendar and ALL its events"). With arg: find by name. Without arg: interactive picker.

New shared helpers:
- `pickCalendar(client, args)` — finds calendar by name or shows huh.Select picker (writable only)
- `buildSourceOptions(calendars)` — extracts unique source names from writable calendars for create interactive mode

### UI additions (`internal/ui/output.go`)
- `PrintCreatedCalendar(c *calendar.Calendar)` — green "Created:" with title, source, color, ID
- `PrintUpdatedCalendar(c *calendar.Calendar)` — green "Updated:" with title, source, color, ID

### Documentation updates
- **README.md**: Added "Managing Calendars" section with 8 example commands. Updated commands table with 4 new calendar subcommands.
- **website/content/docs/commands.md**: Added `cal calendars create`, `cal calendars update`, `cal calendars delete` sections with flags tables and examples. Updated overview table.
- **skills/cal-cli/SKILL.md**: Added "Calendar Management" command group table. Updated description and quick start.
- **skills/cal-cli/references/commands.md**: Added full flag references for all 3 new subcommands.
- **CLAUDE.md**: Updated architecture tree to reflect calendars.go as "Calendar CRUD" not just "List calendars".

## Key Insights
- `calendars` as parent with `RunE` delegating to `list` subcommand gives backwards compatibility: `cal calendars` still lists calendars
- `pickCalendar()` filters to writable calendars only for interactive picker — prevents users from selecting immutable calendars to update/delete
- macOS EventKit actually allows renaming subscription calendars (tested with "US Holidays") — the `ErrImmutable` error only fires for truly locked calendars. The `readOnly` flag from `Calendars()` is a better pre-filter.
- `CreateCalendarInput.Source` must match an exact source name from existing calendars (e.g., "iCloud", not "icloud"). Case-sensitivity is enforced by EventKit.
- EventKit may adjust the hex color slightly (e.g., `#FF6961` → `#FF8073`, `#42D692` → `#4BDAA3`) — this is normal CGColor conversion behavior.

## Decisions Made
- **Subcommands over flags**: `calendars create/update/delete` as subcommands (not `--create` flags) follows the established pattern of the event `add/update/delete` being separate commands
- **Name-based identification**: Calendars are identified by name (not ID) in CLI args because calendar IDs are opaque UUIDs that users never see. Case-insensitive matching via `strings.EqualFold`
- **No `--source` on update**: Can't move a calendar between sources (iCloud → Google). This is an EventKit limitation — source is immutable after creation
- **`pickCalendar` in calendars.go**: Unlike `pickEvent` which lives in `delete.go`, the calendar picker is colocated with the calendar commands since it's only used there
- **Hex color validation**: Only validates format in interactive mode (`#RGB` or `#RRGGBB`). Flag mode passes through to EventKit which handles its own validation.

## Testing
- Full E2E lifecycle: create → verify → update (rename + recolor) → verify → delete → verify gone
- Error cases: missing source, missing title, non-existent calendar, no changes on update
- Immutable calendar handling tested (subscription calendars — turns out rename works, EventKit is permissive)
- Backwards compatibility: `cal calendars` still lists, `cal cals` alias works, all existing commands unaffected
- All 89 unit tests pass, `go vet` clean

---
