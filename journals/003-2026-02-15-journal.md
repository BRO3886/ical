# Journal Entry 003 - 2026-02-15 - Install Script & Tarball Releases

## Goal

Add curl-pipe-bash install script, tarball releases (arm64 + amd64), and tabbed install UI on the website — mirroring the release infrastructure from `../rem` (v0.4.0). Also update domain references from `cal.sidv.dev` to `ical.sidv.dev`.

## What Changed

- **`scripts/install.sh`** (79 lines): Curl-pipe-bash installer
  - macOS-only gate (`uname -s`), arch detection (arm64/amd64)
  - Resolves latest version via GitHub API (`/repos/BRO3886/ical/releases/latest`)
  - Downloads `.tar.gz` tarball, extracts, installs to `/usr/local/bin`
  - Uses `sudo` only if install dir is not writable
  - `INSTALL_DIR` env var override supported
  - Cleanup via `trap 'rm -rf "$TMPDIR_PATH"' EXIT`

- **`website/static/install`**: Copy of `scripts/install.sh` served by Hugo at `ical.sidv.dev/install`

- **`Makefile`**: Added `release` target
  - Loops over arm64 and amd64, builds with `CGO_ENABLED=1 GOARCH=$$arch`
  - `chmod +x` before tarring to preserve execute permissions
  - Outputs `bin/ical-darwin-{arm64,amd64}.tar.gz`
  - Also added `help` target and `.DEFAULT_GOAL := help`

- **`website/themes/cal-docs/layouts/index.html`**: Replaced two-option install section with tabbed UI
  - Three tabs: Script (recommended), Go Install, Download (manual tarball)
  - Uses `data-tab`/`data-panel` attributes for tab switching
  - Copy buttons with `data-copy` on each code block
  - Multi-line code block for manual download method

- **`website/themes/cal-docs/static/css/style.css`**: Added tab styles
  - `.install-tabs`, `.install-tab`, `.install-panel`, `.install-note`, `.code-block-multi`
  - Dark mode variant for tab shadow
  - `fadeIn` animation on panel switch

- **`website/themes/cal-docs/static/js/main.js`**: Added tab switching logic + fixed terminal animation
  - Install tabs: click handler toggles `active` class and `aria-selected`
  - Terminal commands: `cal` → `ical` in all 4 demo commands

- **`README.md`**: Install section expanded from 2 methods to 4
  - Quick install (curl script, recommended), Go install, manual tarball (Apple Silicon + Intel), build from source
  - Domain references updated to `ical.sidv.dev`

- **`website/content/docs/getting-started.md`**: Added all 4 install methods, fixed `iical` typos

- **`internal/export/ics.go`**: Minor cleanup — `strings.TrimPrefix` instead of manual `HasPrefix` + slice

## Key Insights

- **Tarballs preserve file permissions**: HTTP downloads (`curl -o`) always create files with `644` permissions. Tarballs are the standard solution because `tar` preserves the `+x` bit. This is the whole reason for `.tar.gz` over raw binary downloads.

- **Domain is `ical.sidv.dev`** (not `cal.sidv.dev`): The Cloudflare Pages project is still named `cal` but the domain has been updated to `ical.sidv.dev` to match the binary name.

- **Terminal animation still had `cal`**: The rename session (002) missed the JS terminal animation commands — they still said `cal today`, `cal add`, etc. Fixed to `ical`.

- **`iical` typos in docs**: The rename session's sed replacement created double-i typos (`iical`) in `getting-started.md`. The `s/cal/ical/g` pattern matched `ical` → `iical`. Fixed with `replace_all`.

- **No CI for releases**: Same as rem — macOS GitHub Actions runners cost 10x on free tier. Manual `make release` + `gh release create` is the pragmatic approach for a macOS-only cgo binary.

## Decisions Made

1. **Exact same release infrastructure as rem**: Install script structure, Makefile release target, tabbed website UI, README layout — all mirror rem for consistency across the two tools.

2. **`ical.sidv.dev` domain**: Updated from `cal.sidv.dev` to match the binary rename. Cloudflare project name stays `cal` (renaming would require new DNS setup).

3. **Version v0.4.0**: Tagged and released with both arm64 and amd64 tarballs attached.

4. **Include pre-existing ics.go cleanup**: Minor `strings.TrimPrefix` refactor was already staged — included in the release commit rather than making a separate commit.

---
