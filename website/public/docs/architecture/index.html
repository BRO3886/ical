<!DOCTYPE html>
<html lang="en-us" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Architecture — cal — CLI for macOS Calendar</title>
  <meta name="description" content="How cal works under the hood — EventKit bindings, project structure, and design decisions.">
  <meta name="author" content="Siddharth Verma">
  <meta name="keywords" content="macOS Calendar CLI, cal CLI, command line calendar, Go CLI tool, EventKit, macOS productivity, calendar management, Apple Calendar terminal, iCal CLI">

  
  <meta property="og:title" content="Architecture">
  <meta property="og:description" content="How cal works under the hood — EventKit bindings, project structure, and design decisions.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="/docs/architecture/">
  <meta property="og:site_name" content="cal — CLI for macOS Calendar">
  <meta property="og:image" content="/images/og-image.png">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Architecture">
  <meta name="twitter:description" content="How cal works under the hood — EventKit bindings, project structure, and design decisions.">

  
  <link rel="canonical" href="/docs/architecture/">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "TechArticle",
    "name": "cal — CLI for macOS Calendar",
    "url": "\/",
    "description": "A native macOS Calendar CLI built with Go and EventKit. 3000x faster than AppleScript. Full CRUD, natural language dates, recurrence, import\/export, and multiple output formats.",
    
    "headline": "Architecture",
    "author": {
      "@type": "Person",
      "name": "Siddharth Verma"
    },
    
    "publisher": {
      "@type": "Organization",
      "name": "cal"
    }
  }
  </script>

  
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">

  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

  
  <link rel="stylesheet" href="/css/style.css">

  <meta name="generator" content="Hugo 0.92.2" />
</head>
<body>
  <nav class="nav" id="nav">
  <div class="nav-inner">
    <a href="/" class="nav-logo">
      <span class="nav-logo-icon">
        <svg width="20" height="20" viewBox="0 0 32 32" fill="none">
          <rect width="32" height="32" rx="7" fill="var(--accent)"/>
          <rect x="6" y="4" width="20" height="3" rx="1.5" fill="rgba(255,255,255,0.3)"/>
          <text x="16" y="23" text-anchor="middle" font-family="-apple-system,system-ui,sans-serif" font-weight="700" font-size="14" fill="#fff">11</text>
        </svg>
      </span>
      <span class="nav-logo-text">cal</span>
    </a>

    <button class="nav-toggle" id="nav-toggle" aria-label="Toggle navigation">
      <span></span>
      <span></span>
    </button>

    <div class="nav-links" id="nav-links">
      
        <a href="/docs/getting-started/" class="nav-link"
          >
          Getting Started
          
        </a>
      
        <a href="/docs/commands/" class="nav-link"
          >
          Commands
          
        </a>
      
        <a href="/docs/date-parsing/" class="nav-link"
          >
          Date Parsing
          
        </a>
      
        <a href="/docs/architecture/" class="nav-link"
          >
          Architecture
          
        </a>
      
        <a href="https://github.com/BRO3886/cal" class="nav-link nav-link-github"
          target="_blank" rel="noopener noreferrer">
          GitHub
          
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
          
        </a>
      
      <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
        <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
        <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
      </button>
    </div>
  </div>
</nav>


  <main>
    
<div class="docs-layout">
  <aside class="docs-sidebar" id="docs-sidebar">
    <nav class="sidebar-nav">
      <div class="sidebar-section">
        <h4>Documentation</h4>
        
        
          
            <a href="/docs/getting-started/" class="sidebar-link">
              Getting Started
            </a>
          
        
          
            <a href="/docs/commands/" class="sidebar-link">
              Commands
            </a>
          
        
          
            <a href="/docs/date-parsing/" class="sidebar-link">
              Date Parsing
            </a>
          
        
          
            <a href="/docs/architecture/" class="sidebar-link active">
              Architecture
            </a>
          
        
          
        
      </div>
    </nav>
  </aside>
  <article class="docs-content">
    <div class="docs-header fade-in">
      <h1>Architecture</h1>
      <p class="docs-description">How cal works under the hood — EventKit bindings, project structure, and design decisions.</p>
    </div>
    <div class="docs-body fade-in delay-1">
      <h2 id="overview">Overview</h2>
<p>cal is a native macOS CLI that manages Calendar events through <a href="https://github.com/BRO3886/go-eventkit">go-eventkit</a>, a Go library providing direct EventKit bindings via cgo. This gives cal near-native performance — roughly 3000x faster than AppleScript-based alternatives.</p>
<p>The entire application compiles to a single binary with no runtime dependencies beyond macOS itself.</p>
<h2 id="how-it-works">How It Works</h2>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">User → cal CLI (Cobra) → go-eventkit → EventKit (Objective-C via cgo) → Calendar.app store
</code></pre></div><ol>
<li>The user invokes a command via the Cobra CLI framework</li>
<li>Commands call functions in the <code>go-eventkit/calendar</code> package</li>
<li>go-eventkit uses cgo to call EventKit&rsquo;s Objective-C APIs directly</li>
<li>EventKit reads from and writes to the same store that Calendar.app uses</li>
</ol>
<p>There is no IPC, no subprocess spawning, and no Apple Events bridge. The Go binary links against EventKit at compile time.</p>
<h2 id="project-structure">Project Structure</h2>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">cal/
├── cmd/cal/
│   ├── main.go                  # Entry point (macOS check, version injection)
│   └── commands/                # One file per Cobra command
│       ├── root.go              # Root command + global flags (--output, --no-color)
│       ├── calendars.go         # List calendars
│       ├── list.go              # List events (date range, filters)
│       ├── show.go              # Show single event detail
│       ├── add.go               # Create event (flags + interactive -i)
│       ├── update.go            # Update event (flags + interactive -i)
│       ├── delete.go            # Delete event + pickEvent() helper
│       ├── helpers.go           # Shared helpers
│       ├── today.go             # Shortcut: today&#39;s events
│       ├── upcoming.go          # Next N days
│       ├── search.go            # Search events
│       ├── export.go            # Export events (JSON/CSV/ICS)
│       └── import.go            # Import events (JSON/CSV)
├── internal/
│   ├── parser/                  # Natural language date parsing
│   │   ├── date.go
│   │   └── date_test.go
│   ├── ui/                      # Output formatting (table/json/plain)
│   │   └── output.go
│   └── export/                  # Import/export logic
│       ├── json.go
│       ├── csv.go
│       └── ics.go
├── Makefile
└── go.mod
</code></pre></div><h2 id="key-dependencies">Key Dependencies</h2>
<table>
<thead>
<tr>
<th>Package</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>github.com/BRO3886/go-eventkit</code></td>
<td>Native EventKit bindings (cgo)</td>
</tr>
<tr>
<td><code>github.com/spf13/cobra</code></td>
<td>CLI framework</td>
</tr>
<tr>
<td><code>github.com/olekukonko/tablewriter</code></td>
<td>Table output formatting</td>
</tr>
<tr>
<td><code>github.com/fatih/color</code></td>
<td>Terminal colors</td>
</tr>
<tr>
<td><code>github.com/charmbracelet/huh</code></td>
<td>Interactive forms and select menus</td>
</tr>
</tbody>
</table>
<h2 id="design-decisions">Design Decisions</h2>
<h3 id="row-numbers-instead-of-short-ids">Row Numbers Instead of Short IDs</h3>
<p>Calendar event identifiers in EventKit share a common prefix per calendar — the UUID before the <code>:</code> separator is the calendar ID, not the event ID. This makes short ID prefixes useless for disambiguation when events belong to the same calendar.</p>
<p>Instead, cal uses sequential row numbers (<code>#1</code>, <code>#2</code>, &hellip;) displayed in table output. These numbers are cached to <code>~/.cal-last-list</code> so subsequent commands like <code>cal show 2</code> or <code>cal delete 1</code> can reference events from the last listing.</p>
<h3 id="three-event-selection-methods">Three Event Selection Methods</h3>
<ol>
<li><strong>Interactive picker</strong> — No arguments triggers a searchable list powered by <code>charmbracelet/huh</code></li>
<li><strong>Row number</strong> — Numeric argument maps to cached row from last listing</li>
<li><strong>Event ID</strong> — Full or partial <code>eventIdentifier</code> for scripting and automation</li>
</ol>
<h3 id="end-of-day-bumping">End-of-Day Bumping</h3>
<p>When <code>--to</code> resolves to midnight (00:00:00), cal bumps it to 23:59:59 so that <code>--to &quot;feb 12&quot;</code> includes all events on February 12. Without this, midnight would exclude the entire day.</p>
<h3 id="utc-to-local-conversion">UTC to Local Conversion</h3>
<p>EventKit returns all times in UTC. cal converts them to local time using the event&rsquo;s timezone (or the system timezone) for display. JSON output preserves ISO 8601 timestamps.</p>
<h2 id="limitations">Limitations</h2>
<p>These are Apple-imposed constraints, not bugs:</p>
<ul>
<li><strong>Attendees and organizer are read-only</strong> — EventKit does not allow modifying attendee lists</li>
<li><strong>Subscribed calendars are read-only</strong> — Cannot create or modify events in subscribed calendars</li>
<li><strong>Birthday calendars are read-only</strong> — The Birthdays calendar is auto-generated</li>
<li><strong>macOS only</strong> — EventKit is an Apple framework; cal exits gracefully on other platforms</li>
<li><strong>Date ranges required</strong> — EventKit requires bounded queries; cal does not support unbounded event fetches</li>
</ul>

    </div>
    <div class="docs-footer">
      
        <a href="/docs/date-parsing/" class="docs-nav-link docs-nav-prev">
          <span class="docs-nav-label">Previous</span>
          <span class="docs-nav-title">Date Parsing</span>
        </a>
      
      
    </div>
  </article>
</div>

  </main>

  <footer class="footer">
  <div class="footer-inner">
    <div class="footer-brand">
      <span class="footer-logo">cal</span>
      <p class="footer-tagline">A native CLI for macOS Calendar.</p>
    </div>
    <div class="footer-links">
      <div class="footer-col">
        <h4>Documentation</h4>
        <a href="/docs/getting-started/">Getting Started</a>
        <a href="/docs/commands/">Commands</a>
        <a href="/docs/date-parsing/">Date Parsing</a>
      </div>
      <div class="footer-col">
        <h4>Resources</h4>
        <a href="/docs/architecture/">Architecture</a>
        <a href="https://github.com/BRO3886/cal" target="_blank" rel="noopener">GitHub</a>
      </div>
      <div class="footer-col">
        <h4>About</h4>
        <a href="https://sidv.dev" target="_blank" rel="noopener">Siddhartha Varma</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>Built with Go + EventKit. Open source under MIT License.</p>
    </div>
  </div>
</footer>

  <script src="/js/main.js"></script>
</body>
</html>
